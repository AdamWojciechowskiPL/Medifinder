<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medifinder 2.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Login Overlay -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <h1 class="logo-text">Medifinder</h1>
            <p>Zaloguj siƒô kontem Google, aby kontynuowaƒá</p>
            <button class="google-btn" onclick="loginWithGoogle()">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="G">
                Zaloguj przez Google
            </button>
        </div>
    </div>

    <!-- Main App -->
    <div id="appContent" class="app-container hidden">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">üè• Medifinder</div>
            <div class="user-menu">
                <span id="userLabel" class="user-label">--</span>
                <span class="separator">|</span>
                <span id="currentProfileLabel" class="profile-label" onclick="toggleProfilesModal()">Wybierz profil</span>
                <button id="authBtn" class="btn btn-sm btn-outline">Wyloguj</button>
            </div>
        </header>

        <!-- Main Grid -->
        <main class="main-grid">
            <!-- Sidebar / Filters -->
            <aside class="filters-panel">
                
                <!-- SECTION 1: SEARCH CRITERIA (Scope) -->
                <div class="filters-section">
                    <h3>1. Kryteria wyszukiwania</h3>
                    
                    <div class="form-group">
                        <label>Specjalno≈õƒá</label>
                        <select id="specialtySelect" class="form-control">
                            <option value="">≈Åadowanie...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Zakres dat</label>
                        <div class="date-range">
                            <input type="date" id="dateFrom" class="form-control">
                            <span>-</span>
                            <input type="date" id="dateTo" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Lekarze (<span id="doctorsCount">0</span>)</label>
                        <div class="custom-dropdown" id="doctorsDropdown">
                            <div class="dropdown-trigger" id="doctorsTrigger" onclick="toggleDropdown('doctorsDropdown')">Wybierz...</div>
                            <div class="dropdown-content">
                                <input type="text" class="search-input" placeholder="Szukaj..." onkeyup="filterDropdown(this, 'doctorsList')">
                                <div class="items-list" id="doctorsList"></div>
                                <div class="dropdown-actions">
                                    <button class="btn btn-xs" onclick="clearSelection('doctorsList')">Wyczy≈õƒá</button>
                                    <button class="btn btn-xs btn-primary" onclick="toggleDropdown('doctorsDropdown')">OK</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Plac√≥wki</label>
                        <div class="custom-dropdown" id="clinicsDropdown">
                            <div class="dropdown-trigger" id="clinicsTrigger" onclick="toggleDropdown('clinicsDropdown')">Wybierz...</div>
                            <div class="dropdown-content">
                                <input type="text" class="search-input" placeholder="Szukaj..." onkeyup="filterDropdown(this, 'clinicsList')">
                                <div class="items-list" id="clinicsList"></div>
                                <div class="dropdown-actions">
                                    <button class="btn btn-xs" onclick="clearSelection('clinicsList')">Wyczy≈õƒá</button>
                                    <button class="btn btn-xs btn-primary" onclick="toggleDropdown('clinicsDropdown')">OK</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <hr style="border: 0; border-top: 1px solid #e5e7eb; margin: 20px 0;">

                <!-- SECTION 2: SCHEDULER / AVAILABILITY PREFERENCES -->
                <div class="filters-section">
                    <h3>2. Preferencje terminu / Automat</h3>

                    <div class="form-group">
                        <label>Dni tygodnia</label>
                        <div class="weekdays-grid" id="weekdaysContainer">
                            <!-- JS generated -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Godziny (domy≈õlne)</label>
                        <div class="time-range">
                            <select id="timeFrom" class="form-control"></select>
                            <span>-</span>
                            <select id="timeTo" class="form-control"></select>
                        </div>
                    </div>
                    
                    <!-- Advanced Filters Toggle -->
                    <div class="form-group">
                        <button class="btn btn-sm btn-outline w-100" id="toggleAdvancedFilters">Wiƒôcej opcji (wykluczenia, godziny dniowe) ‚ñº</button>
                    </div>
                    
                    <!-- Advanced Filters Panel (Hidden by default) -->
                    <div id="advancedFiltersPanel" class="advanced-filters hidden" style="margin-top: 10px; padding: 10px; background: #f9fafb; border-radius: 6px; border: 1px solid #e5e7eb;">
                        <h4 style="font-size: 0.9rem; margin-bottom: 8px;">Wykluczone daty</h4>
                        <div class="date-add-row" style="display: flex; gap: 6px; margin-bottom: 8px;">
                            <input type="date" id="excludeDateInput" class="form-control form-control-sm">
                            <button class="btn btn-sm btn-secondary" id="addExcludedDateBtn">+</button>
                        </div>
                        <div id="excludedDatesList" style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 12px;"></div>
                        
                        <h4 style="font-size: 0.9rem; margin-bottom: 8px;">Godziny dla dni tygodnia</h4>
                        <div id="dayTimeRangesContainer" style="display: flex; flex-direction: column; gap: 6px;">
                            <!-- JS generated -->
                        </div>

                        <!-- Minimum Lead Time Filter -->
                        <h4 style="font-size: 0.9rem; margin-bottom: 8px; margin-top: 12px;">Minimalne wyprzedzenie (bufor)</h4>
                        <div class="time-range" style="align-items: center; gap: 5px;">
                            <div style="flex: 1; display: flex; align-items: center; gap: 5px;">
                                <input type="number" id="minLeadTimeHours" class="form-control form-control-sm" value="2" min="0" max="24" style="width: 50px;">
                                <label for="minLeadTimeHours" style="margin: 0; font-size: 0.8rem;">godz</label>
                            </div>
                            <div style="flex: 1; display: flex; align-items: center; gap: 5px;">
                                <input type="number" id="minLeadTimeMinutes" class="form-control form-control-sm" value="0" min="0" max="59" style="width: 50px;">
                                <label for="minLeadTimeMinutes" style="margin: 0; font-size: 0.8rem;">min</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="actions-row">
                    <button id="resetBtn" class="btn btn-outline">Reset</button>
                    <button id="searchBtn" class="btn btn-primary">üîç Wyszukaj</button>
                </div>
            </aside>

            <!-- Main Content / Results -->
            <section class="results-panel">
                <!-- Scheduler Control Bar -->
                <div class="scheduler-bar">
                    <div class="scheduler-controls">
                        <label class="switch">
                            <input type="checkbox" id="enableAutoCheck">
                            <span class="slider round"></span>
                        </label>
                        <div class="status-box">
                            <span class="status-label">Automat:</span>
                            <span id="autoCheckStatus" class="status-value">Wy≈ÇƒÖczony</span>
                        </div>
                        
                        <!-- MODE SELECTION -->
                        <div class="mode-select" style="display: flex; gap: 15px; margin-left: 10px; align-items: center;">
                            
                            <!-- Interval Group -->
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <label class="radio-label" title="Sprawdza co X minut przez 24h" style="margin-bottom: 0;">
                                    <input type="radio" name="schedulerMode" value="interval" checked> Interwa≈Ç
                                </label>
                                
                                <div class="interval-select" id="intervalSelectContainer" style="margin-left: 5px;">
                                    <span style="margin-right: 5px;">co</span>
                                    <select id="checkInterval" class="form-control form-control-sm" style="width: auto; padding: 2px 5px;">
                                        <option value="1">1 min</option>
                                        <option value="2">2 min</option>
                                        <option value="5" selected>5 min</option>
                                        <option value="10">10 min</option>
                                        <option value="15">15 min</option>
                                        <option value="30">30 min</option>
                                        <option value="60">60 min</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Sniper Group -->
                            <label class="radio-label" title="Loguje siƒô 23:55, sprawdza 00:00-00:05. Dzia≈Ça codziennie." style="margin-bottom: 0;">
                                <input type="radio" name="schedulerMode" value="midnight"> üéØ Snajper (00:00)
                            </label>
                        </div>
                    </div>
                    
                    <div class="autobook-control">
                        <label class="checkbox-label" title="Automatycznie rezerwuje pierwszƒÖ znalezionƒÖ wizytƒô">
                            <input type="checkbox" id="autoBook"> ‚ö° Auto-Rezerwacja
                        </label>
                        <!-- TWIN BOOKING UI -->
                        <div class="twin-booking-container" style="margin-left: 10px; display: inline-flex; align-items: center; border-left: 1px solid #ccc; padding-left: 10px;">
                            <label class="checkbox-label" title="Rezerwuj wizyty dla rodze≈Ñstwa po sobie">
                                <input type="checkbox" id="enableTwinBooking"> üëØ Bli≈∫niak
                            </label>
                            <select id="twinProfileSelect" class="form-control form-control-sm" style="width: auto; margin-left: 5px; display: none;">
                                <option value="">Wybierz drugie dziecko...</option>
                            </select>
                        </div>

                        <span id="autoBookStatus" style="font-size: 0.8rem; margin-left: 8px; color: var(--dark);"></span>
                    </div>
                </div>

                <!-- Scheduler Details (Hidden when inactive) -->
                <div id="schedulerDetailsRow" class="scheduler-details" style="display:none; padding: 10px 16px; background: #f0fdf4; border-bottom: 1px solid #dcfce7;">
                     <div id="schedulerDetails" style="font-size: 0.85rem; color: #166534;"></div>
                </div>

                <!-- Results Toolbar -->
                <div class="results-header">
                    <h2>Wyniki wyszukiwania <span id="resultsSource" style="font-size: 0.8rem; font-weight: normal; color: #6b7280; margin-left: 10px;"></span></h2>
                    <div class="results-actions">
                        <button id="bookSelectedBtn" class="btn btn-sm btn-success" disabled>Zarezerwuj zaznaczonƒÖ</button>
                    </div>
                </div>

                <!-- Results Timestamp -->
                <div id="resultsTimestamp" style="padding: 8px 16px; font-size: 0.85rem; color: #6b7280; background: #f9fafb; border-bottom: 1px solid #e5e7eb;"></div>

                <!-- Results Table -->
                <div class="table-container">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Godzina</th>
                                <th>Lekarz</th>
                                <th>Specjalno≈õƒá</th>
                                <th>Plac√≥wka</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody">
                            <tr>
                                <td colspan="5" style="text-align:center; padding: 40px; color: #6b7280;">
                                    U≈ºyj filtr√≥w i kliknij szukaj
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Profiles Modal -->
    <div id="profilesModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="toggleProfilesModal()">&times;</span>
            <h3 style="margin-top: 0;">Wybierz profil Medicover</h3>
            <div id="profilesList" class="profiles-list"></div>
            
            <hr style="border: 0; border-top: 1px solid #e5e7eb; margin: 16px 0;">
            <h4 style="margin-bottom: 12px;">Dodaj nowy profil</h4>
            <form id="addProfileForm" class="add-profile-form">
                <div class="form-row">
                    <input type="text" id="newProfileName" class="form-control" placeholder="Nazwa (np. Jan)" required>
                    <input type="text" id="newProfileLogin" class="form-control" placeholder="Numer karty (MRN)" required>
                </div>
                <div class="form-row">
                    <input type="password" id="newProfilePass" class="form-control" placeholder="Has≈Ço" required>
                </div>
                <div class="form-row checkbox-row">
                     <label class="checkbox-label">
                        <input type="checkbox" id="newProfileIsChild"> 
                        Konto dziecka?
                    </label>
                </div>
                <button type="submit" class="btn btn-primary w-100" style="margin-top: 4px;">Dodaj profil</button>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="script.js"></script>
</body>
</html>
